<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <!-- bootstrap.css -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css"
        integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
    <link rel="stylesheet" href="/live2d/css/style.css" />
</head>
<body style="background-color:#0b0b0b;">
    <!-- navbar -->
    <nav id="navbar" class="navbar navbar-expand-sm navbar-light bg-light fixed-top">
        <a class="navbar-brand" href="#">Main</a>
        <button class="navbar-toggler d-lg-none" type="button" data-toggle="collapse" data-target="#collapsibleNavId"
            aria-controls="collapsibleNavId" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="collapsibleNavId">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a class="nav-link" id="signout_btn" data-toggle="modal" href="#signOutModal" href="#">Sign Out</a>
                </li>
            </ul>
        </div>
    </nav>
    <!-- navbar end -->
    <header class="jumbotron" style="background: #0b0b0b;">
        <div class="logo">
          <a title="Home" href="https://www.youtube.com/watch?v=dQw4w9WgXcQ">
            <img src="../material/banner.png" style="display:block; margin:auto;" alt="Logo">
          </a>
        </div>
        <div class="nav-wrapper">
          <span class="icon-menu" style="display: none;"></span>
          <nav class="user-nav" id="user-nav">
          </nav>
        </div>
    </header>
    <section class="py-4" style="background-color: gray;">
        <div class="container">
            <div class="text-center mb-12">
                <h2 class="text-center">Welcome Here is admin</h2>
            </div>
            <div class="container">
                <div id="List" class="col">
                    <!--can-->
                    <div class="col-md-12 col-6">
                        <div class="card my-1">
                            <div class="card-body">
                                <h4 class="card-title mb-0">總罐罐</h4>
                                <div class="category-list my-2">
                                    <h4 id="total" class="card-title mb-0">Total：0</h4>
                                    <button id="clear">clear</button>
                                    <button id="add100">+100</button>
                                    <button id="add1000">+1000</button>
                                    <button id="add10000">+10000</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--talk-->
                    <div class="col-md-12 col-6">
                        <div class="card my-1">
                            <div class="card-body">
                                <h4 class="card-title mb-0">會講的句子</h4>
                                <div class="category-list my-2">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>id</th>
                                                <th>句子</th>
                                                <th></th>
                                            </tr>
                                        </thead>
                                        <tbody id="scTableBody">
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- footer -->
        <footer id="footer" class="text-center mt-4">
            <p>Final project 2022</p>
        </footer>
        <!-- footer end -->
    </section>
<!--script-->
<script type="text/javascript" src="https://cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script type="text/javascript">
    var message_Path = '/live2d/'
    var home_Path = 'https://haremu.com/'
</script>
<!--  require -->

<!--  Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
<!--  js -->
<script type="text/javascript" src="/live2d/js/data.js">
    const firebaseConfig = {
  apiKey: "AIzaSyA9KdxVEPhhrF8E2IrtiIC550fM6cI7EqI",
  authDomain: "webfinal-75cc4.firebaseapp.com",
  projectId: "webfinal-75cc4",
  storageBucket: "webfinal-75cc4.appspot.com",
  messagingSenderId: "907654408665",
  appId: "1:907654408665:web:60851c1916e12c143951c8",
  measurementId: "G-95GSC7601Y"
};

  // Initialize Firebase
const app = firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const $moreCan=$("#moreCan");
const $All=$("#All");
const $total=$("#total");
const $client=$("#client");
const $talkbtn=$("#talkbtn");
const $talkinput=$("#talkinput");

var global_can=0;
var client_can=0;

const cat = db.collection("cat").doc("0");

async function getcan(){
  const todoDocs = await cat.get();
  const {can,talk} = todoDocs.data();
  console.log(can);
  $All.text("我的罐罐："+String(can));
  $total.text("Total："+String(can));
}
getcan();

$moreCan.on('click',async(event)=>{
  event.preventDefault();
  //get Data
  const todoDocs = await cat.get();
  const {can,talk} = todoDocs.data();
  global_can=can;
  global_can+=1;
  console.log(can);
  //console.log(talk);
  client_can+=1;
  //print
  $All.text("我的罐罐："+String(global_can));
  $client.text("貢獻的罐罐："+String(client_can));
  cat.set({
    can:global_can,
    talk:talk
  });
})

$talkbtn.on('click',async(event) => {
  event.preventDefault();
  const t=$talkinput.val();
  if(t==""){
    alert('沒有輸入');
  }
  else{
    const todoDocs = await cat.get();
    const {can,talk} = todoDocs.data();
    global_can=can;
    talk.push(t);
    cat.set({
      can:global_can,
      talk:talk
    });
    alert('新增成功');
    console.log(talk);
    $talkinput.text("");
    $talkinput.val("");
  }
})
</script>
<script type="text/javascript" src="/live2d/js/admin.js">
    const $clear=$("#clear");
const $add100=$("#add100");
const $add1000=$("#add1000");
const $add10000=$("#add10000");

$clear.on('click',async(event)=>{
    event.preventDefault();
    //get Data
    const todoDocs = await cat.get();
    const {can,talk} = todoDocs.data();
    global_can=can;
    global_can=0;
    console.log(can);
    //console.log(talk);
    //print
    $All.text("我的罐罐："+String(global_can));
    $total.text("Total："+String(can));
    cat.set({
      can:global_can,
      talk:talk
    });
})

$add100.on('click',async(event)=>{
    event.preventDefault();
    //get Data
    const todoDocs = await cat.get();
    const {can,talk} = todoDocs.data();
    global_can=can;
    global_can+=100;
    console.log(can);
    //console.log(talk);
    //print
    $All.text("我的罐罐："+String(global_can));
    $total.text("Total："+String(can));
    cat.set({
      can:global_can,
      talk:talk
    });
})

$add1000.on('click',async(event)=>{
    event.preventDefault();
    //get Data
    const todoDocs = await cat.get();
    const {can,talk} = todoDocs.data();
    global_can=can;
    global_can+=1000;
    console.log(can);
    //console.log(talk);
    //print
    $All.text("我的罐罐："+String(global_can));
    $total.text("Total："+String(can));
    cat.set({
      can:global_can,
      talk:talk
    });
})

$add10000.on('click',async(event)=>{
    event.preventDefault();
    //get Data
    const todoDocs = await cat.get();
    const {can,talk} = todoDocs.data();
    global_can=can;
    global_can+=10000;
    console.log(can);
    //console.log(talk);
    //print
    $All.text("我的罐罐："+String(global_can));
    $total.text("Total："+String(can));
    cat.set({
      can:global_can,
      talk:talk
    });
})
const $scTableBody=$("#scTableBody");

//sentence
async function getsc(){
    const todoDocs = await cat.get();
    const {can,talk} = todoDocs.data();
    for (let i=0; i<talk.length; i++){
        const row=`
            <tr>
                <td>${i}</td>
                <td>
                    ${talk[i]}
                </td>
                <td>
                    <button data-id="${i}" class="btn btn-danger delete-btn">Delete</button>
                </td>
            </tr>
        `;
        $scTableBody.append(row);
    }
    console.log(talk);
}
getsc();

$('body').delegate(".delete-btn", "click",async function () {
    console.log(this);
    const todoDocs =await cat.get();
    const {can,talk} = todoDocs.data();
    const temp=talk;
    temp.splice($(this).attr("data-id"),1);

    cat.set({
        can:can,
        talk:temp
    });
    getsc();
});
</script>
<script type="text/javascript" src="/live2d/js/login.js">
    //sign in form
var $signin_btn=$("#signin_btn"),
    $account_signin=$("#account_signin"),
    $password_signin=$("#password_signin");

//sign up form
var $signup_btn=$("#signup_btn"),
    $account_signup=$("#account_signup"),
    $password_signup=$("#password_signup");

//sign out form
var $signout_btn=$("#signout_btn");

$signup_btn.click(function (e) {
    e.preventDefault();
    // When sign up form submitted
    console.log("Ready for sign up");
    const email = $account_signup.val();
    const password = $password_signup.val();
    console.log(email, password);
    //firebase sign in method
    firebase
        .auth()
        .createUserWithEmailAndPassword(email, password)
        .then(res => {
            console.log("Sign up", res);
            alert("sign up complete");
        })
        .catch(err => {
            if (err.code == "auth/wrong-password") {
                alert("wrong password");
            }else if (err.code == "auth/user-not-found") {
                alert("user not found");
            }
        })
    console.log("Ready for sign up");
    $account_signup.val("");
    $password_signup.val("");
});

//admin@gmail.com
//123456

$signin_btn.click(function (e) {
    e.preventDefault();
    // When sign in form submitted
    console.log("Ready for sign in");
    const email = $account_signin.val();
    const password = $password_signin.val();
    console.log(email, password);
    //firebase sign in method
    firebase
        .auth()
        .signInWithEmailAndPassword(email, password)
        .then(res => {
            console.log("Sign In Complete", res);
            alert("sign in");
            if (email == "admin@gmail.com") {
                window.location = "src/admin.html";
            }
            else{
                window.location = "src/demo.html";
            }
        })
        .catch(err => {
            if (err.code == "auth/wrong-password") {
                alert("wrong password");
            }else if (err.code == "auth/user-not-found") {
                alert("user not found");
            }
        })
});

$signout_btn.click(function () {
    // When click sign out button
    console.log("Ready for sign out");
    firebase
        .auth()
        .signOut()
        .then(() => {
            window.location = "../index.html"
        })
        .cathc()
});
</script>
<script type="text/javascript" src="/live2d/js/message.js">
    function renderTip(template, context) {
    var tokenReg = /(\\)?\{([^\{\}\\]+)(\\)?\}/g;
    return template.replace(tokenReg, function (word, slash1, token, slash2) {
        if (slash1 || slash2) {
            return word.replace('\\', '');
        }
        var variables = token.replace(/\s/g, '').split('.');
        var currentObject = context;
        var i, length, variable;
        for (i = 0, length = variables.length; i < length; ++i) {
            variable = variables[i];
            currentObject = currentObject[variable];
            if (currentObject === undefined || currentObject === null) return '';
        }
        return currentObject;
    });
}

String.prototype.renderTip = function (context) {
    return renderTip(this, context);
};

var re = /x/;
console.log(re);
re.toString = function() {
    showMessage('喵！！', 5000);
    return '';
};

$(document).on('copy', function (){
    showMessage('想要複製帶走的話，罐罐先拿來', 5000);
});

async function initTips(){
    const todoDocs =await cat.get();
    const {can,talk} = todoDocs.data();
    $.ajax({
        cache: true,
        url: `${message_Path}message.json`,
        dataType: "json",
        success: function (result){
            $.each(result.mouseover, function (index, tips){
                $(tips.selector).mouseover(function (){
                    var text = talk;
                    console.log(text);
                    if(Array.isArray(talk)) text = talk[Math.floor(Math.random() * talk.length + 1)-1];
                    text = text.renderTip({text: $(this).text()});
                    showMessage(text, 3000);
                });
            });
            $.each(result.click,function (index, tips){
                $(tips.selector).click(function (){
                    var text = talk;
                    console.log(text);
                    if(Array.isArray(talk)) text = talk[Math.floor(Math.random() * talk.length + 1)-1];
                    text = text.renderTip({text: $(this).text()});
                    showMessage(text, 3000);
                });
            });
        }
    });
}
initTips();

(function (){
    var text;
    if(document.referrer !== ''){
            var now = (new Date()).getHours();
            if (now > 23 || now <= 5) {
                text = '不要再看了！！罐罐呢！！';
            } else if (now > 5 && now <= 7) {
                text = '給我罐罐好嗎？';
            } else if (now > 7 && now <= 11) {
                text = '你還有'+String(12-now)+'個小時決定午餐要吃甚麼';
            } else if (now > 11 && now <= 14) {
                text = '所以...午餐要吃啥！';
            } else if (now > 14 && now <= 17) {
                text = '罐罐呢？？？';
            } else if (now > 17 && now <= 19) {
                text = '晚餐就決定是高級罐罐了';
            } else if (now > 19 && now <= 21) {
                text = '整天只知道工作，回家後還不給我罐罐！！';
            } else if (now > 21 && now <= 23) {
                text = '罐罐罐罐罐罐罐罐罐罐罐罐罐罐罐罐罐罐罐罐罐罐罐罐罐罐罐罐罐罐罐罐罐罐罐罐罐罐罐罐罐罐罐罐罐罐罐罐罐罐';
            } else {
                text = '還沒睡的話，給個罐罐吧';
            }
    }
    showMessage(text, 12000);
})();

function showMessage(text, timeout){
    if(Array.isArray(text)) text = text[Math.floor(Math.random() * text.length + 1)-1];
    //console.log('showMessage', text);
    $('.message').stop();
    $('.message').html(text).fadeTo(200, 1);
    if (timeout === null) timeout = 5000;
    hideMessage(timeout);
}

function hideMessage(timeout){
    $('.message').stop().css('opacity',1);
    if (timeout === null) timeout = 5000;
    $('.message').delay(timeout).fadeTo(200, 0);
}


</script>
</body>
</html>